<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>–≠–º–∏–ª—å PDF</title>
    <meta name="description"
        content="–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –∏–∑–º–µ—Ä–µ–Ω–∏—è —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–π –Ω–∞ PDF –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö. –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞, —Ä–∏—Å–æ–≤–∞–Ω–∏–µ –ª–∏–Ω–∏–π, –ø–æ–¥—Å—á—ë—Ç –¥–ª–∏–Ω—ã –≤ –º–º/—Å–º/–º." />

    <!-- PDF.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
    <!-- jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <link rel="stylesheet" href="styles.css?v=92" />
</head>

<body>
    <!-- –≠–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ -->
    <div class="projects-screen" id="projectsScreen">
        <div class="projects-container">
            <div class="projects-header">
                <a href="#" class="app-brand">
                    <svg viewBox="0 0 24 24" fill="none" class="app-logo-icon" stroke="currentColor" stroke-width="2">
                        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" stroke-linecap="round"
                            stroke-linejoin="round" />
                    </svg>
                    <div>
                        <div class="app-brand-text" style="font-size: 24px;">–≠–º–∏–ª—å PDF</div>
                        <div class="logo-sub-text">–ò–∑–º–µ—Ä–∏—Ç–µ–ª—å –¥–ª—è —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞</div>
                    </div>
                </a>
            </div>

            <div class="projects-content">
                <h2 class="projects-title">–í–∞—à–∏ –ø—Ä–æ–µ–∫—Ç—ã</h2>
                <p class="projects-subtitle">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π. –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ.</p>

                <div class="projects-grid" id="projectsGrid">
                    <!-- –ü—Ä–æ–µ–∫—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
                </div>

                <div class="add-project-card" id="addProjectCard">
                    <div class="add-project-icon">‚ûï</div>
                    <div class="add-project-text">–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–µ–∫—Ç</div>
                    <div class="add-project-hint">–ó–∞–≥—Ä—É–∑–∏—Ç–µ PDF —á–µ—Ä—Ç—ë–∂</div>
                    <input type="file" id="newProjectFile" accept="application/pdf,.pdf" />
                </div>
            </div>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ä–∞–±–æ—Ç—ã —Å PDF -->
    <div class="app-screen" id="appScreen" style="display: none;">
        <div class="topbar" id="topbar">
            <button class="btn btn-back" id="backToProjects" title="–ö –ø—Ä–æ–µ–∫—Ç–∞–º">
                <span class="back-icon">‚Üê</span>
                <span class="project-name-top" id="currentProjectName">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞</span>
            </button>

            <button class="app-brand-mini" id="logoBtn"
                style="cursor: default; background: transparent; border: none; padding-left: 0;">
                <svg viewBox="0 0 24 24" fill="none" class="app-logo-icon" stroke="#fff" stroke-width="2.5"
                    style="filter: drop-shadow(0 0 12px rgba(124, 92, 255, 1)); overflow: visible; width: 24px;">
                    <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" stroke-linecap="round"
                        stroke-linejoin="round" fill="rgba(124, 92, 255, 0.6)" />
                </svg>
                <div class="brand-text-col">
                    <span class="app-brand-text"
                        style="color: #fff; text-shadow: 0 0 15px rgba(124, 92, 255, 0.8);">–≠–º–∏–ª—å PDF</span>
                </div>
            </button>

            <div class="spacer"></div>

            <div class="rightbar">
                <div class="seg" title="–°—Ç—Ä–∞–Ω–∏—Ü—ã">
                    <button class="seg-btn" id="prevBtn" disabled aria-label="–ü—Ä–µ–¥—ã–¥—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞">‚Äπ</button>
                    <div class="seg-mid" id="pageInfo" role="button" tabindex="0" aria-label="–í—ã–±–æ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã">0 / 0
                    </div>
                    <button class="seg-btn" id="nextBtn" disabled aria-label="–°–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞">‚Ä∫</button>
                </div>

                <button class="btn btn-icon-only btn-calibration btn-expandable" id="rulerToolBtn" aria-label="–†—É–ª–µ—Ç–∫–∞">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round" class="tape-measure-icon">
                        <!-- –õ–µ–Ω—Ç–∞ (–≤—ã–µ–∑–∂–∞—é—â–∞—è —á–∞—Å—Ç—å) -->
                        <g class="tape-tongue">
                            <!-- –û—Å–Ω–æ–≤–Ω–∞—è –ª–∏–Ω–∏—è –ª–µ–Ω—Ç—ã –∏ –∫—Ä—é—á–æ–∫ -->
                            <path d="M10 17h11 M21 14v5" stroke-width="2"></path>
                            <!-- –î–µ–ª–µ–Ω–∏—è (–∑–∞—Å–µ—á–∫–∏) -->
                            <path d="M12 16v2 M15 16v2 M18 16v2" stroke-width="1.5" opacity="0.8"></path>
                        </g>
                        <!-- –ö–æ—Ä–ø—É—Å —Ä—É–ª–µ—Ç–∫–∏ -->
                        <path d="M1 17V7a3 3 0 0 1 3-3h8a3 3 0 0 1 3 3v10a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2z" fill="#0f1b33"
                            stroke="currentColor" stroke-width="2"></path>
                        <circle cx="8" cy="11" r="3.5" stroke="currentColor" stroke-width="1.5"></circle>
                        <circle cx="8" cy="11" r="1" fill="currentColor"></circle>
                    </svg>
                    <span class="btn-label">–†—É–ª–µ—Ç–∫–∞</span>
                </button>

                <button class="btn btn-icon-only btn-tool-text" id="textToolBtn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path class="text-top" d="M4 7V4h16v3"></path>
                        <path class="text-bottom" d="M9 20h6"></path>
                        <path class="text-cursor" d="M12 4v16"></path>
                    </svg>
                    <span class="btn-label-text">–ù–∞–¥–ø–∏—Å—å</span>
                </button>

                <button class="btn btn-icon-only btn-tool-select" id="selectBtn" disabled>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round" class="scissors-icon">
                        <!-- –í–µ—Ä—Ö–Ω–µ–µ –ª–µ–∑–≤–∏–µ -->
                        <g class="blade-top" style="transform-origin: 9px 12px">
                            <circle cx="6" cy="6" r="3"></circle>
                            <line x1="8.5" y1="8.5" x2="18" y2="18"></line>
                        </g>
                        <!-- –ù–∏–∂–Ω–µ–µ –ª–µ–∑–≤–∏–µ -->
                        <g class="blade-bottom" style="transform-origin: 9px 12px">
                            <circle cx="6" cy="18" r="3"></circle>
                            <line x1="8.5" y1="15.5" x2="18" y2="6"></line>
                        </g>
                    </svg>
                    <span class="btn-label-text">–í—ã–¥–µ–ª–∏—Ç—å</span>
                </button>

                <button class="btn btn-icon-only btn-extract" id="extractPagesBtn" disabled>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round" class="extract-icon">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <g class="arrow-up">
                            <line x1="12" y1="18" x2="12" y2="12"></line>
                            <polyline points="9 15 12 12 15 15"></polyline>
                        </g>
                    </svg>
                    <span class="btn-label-text">–ò–∑–≤–ª–µ—á—å</span>
                </button>

                <button class="btn btn-icon-only btn-primary btn-tiled" id="topbarPrintTiledBtn" disabled>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round" class="printer-icon">
                        <polyline points="6 9 6 2 18 2 18 9"></polyline>
                        <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
                        <g class="paper-out">
                            <rect x="6" y="14" width="12" height="8"></rect>
                        </g>
                    </svg>
                    <span class="btn-label-text">–ü–µ—á–∞—Ç—å</span>
                </button>

                <div class="seg seg-zoom" title="–ú–∞—Å—à—Ç–∞–±">
                    <button class="seg-btn" id="zoomOut" aria-label="–£–º–µ–Ω—å—à–∏—Ç—å">‚àí</button>
                    <div class="zoom-mid" id="zoomLevel">100%</div>
                    <button class="seg-btn" id="zoomIn" aria-label="–£–≤–µ–ª–∏—á–∏—Ç—å">+</button>
                </div>

                <div class="seg" title="–ò—Å—Ç–æ—Ä–∏—è">
                    <button class="seg-btn" id="undoBtn" disabled aria-label="–ù–∞–∑–∞–¥ (Undo)">‚Ü∂</button>
                    <button class="seg-btn" id="redoBtn" disabled aria-label="–í–ø–µ—Ä—ë–¥ (Redo)">‚Ü∑</button>
                </div>

                <div class="counter" id="counter">0 –º–º</div>

                <button class="btn btn-icon-only btn-tool-calibrate" id="calibratePageBtn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="22" y1="12" x2="18" y2="12"></line>
                        <line x1="6" y1="12" x2="2" y2="12"></line>
                        <line x1="12" y1="6" x2="12" y2="2"></line>
                        <line x1="12" y1="22" x2="12" y2="18"></line>
                    </svg>
                    <span class="btn-label-text">–ö–∞–ª–∏–±—Ä–æ–≤–∫–∞</span>
                </button>

                <button class="btn btn-danger btn-icon-only" id="clearPageBtn" title="–°—Ç–µ—Ä–µ—Ç—å –≤—Å—ë –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <polyline points="3 6 5 6 21 6"></polyline>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                    </svg>
                    <span class="btn-label-text">–£–¥–∞–ª–∏—Ç—å</span>
                </button>
            </div>
        </div>

        <div class="thumbs-panel" id="thumbsPanel" aria-hidden="true">
            <div class="thumbs-header">
                <div class="thumbs-title">
                    –°—Ç—Ä–∞–Ω–∏—Ü—ã <span class="pill" id="thumbsCount">0</span>
                </div>
                <div class="thumbs-actions">
                    <button class="thumbs-act" id="thumbsLeft" title="–ü—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –≤–ª–µ–≤–æ">‚Äπ</button>
                    <button class="thumbs-act" id="thumbsRight" title="–ü—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –≤–ø—Ä–∞–≤–æ">‚Ä∫</button>
                    <button class="thumbs-act" id="thumbsClose" title="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
                </div>
            </div>
            <div class="thumbs-strip" id="thumbnails"></div>
        </div>

        <div class="main" id="main">
            <div class="canvas-wrapper" id="canvasWrapper">
                <div class="sheet" id="sheet">
                    <canvas id="pdfCanvas"></canvas>
                    <canvas id="rulerCanvas"></canvas>
                </div>
            </div>
        </div>

        <div class="floating-btn" id="floatingBtn"
            title="–£–¥–µ—Ä–∂–∏–≤–∞–π ‚äï —á—Ç–æ–±—ã —Ä–∏—Å–æ–≤–∞—Ç—å. –ß—Ç–æ–±—ã –ø–µ—Ä–µ–¥–≤–∏–Ω—É—Ç—å ‚Äî —É–¥–µ—Ä–∂–∏ –∏ –ø–æ—Ç—è–Ω–∏">
            ‚äï
        </div>

        <div class="hint-bar" id="hintBar">
            <span class="kbd">Shift</span> —Ä–∏—Å—É–π ‚Ä¢ –æ—Ç–ø—É—Å—Ç–∏–ª ‚Äî –≥–æ—Ç–æ–≤–æ ‚Ä¢ –∫–æ–Ω—Ü—ã ‚Äî —Ç–∞—Å–∫–∞–π
        </div>
    </div>

    <div class="loading" id="loading" aria-hidden="true">
        <div class="loading-card">
            <div class="loading-title">
                <strong id="loadingText">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</strong>
                <div class="brand">–≠–º–∏–ª—å PDF</div>
            </div>
            <div class="loading-sub" id="loadingSub">–ì–æ—Ç–æ–≤–∏–º —Å—Ç—Ä–∞–Ω–∏—Ü—É</div>
            <div class="bar"><i></i></div>
        </div>
    </div>

    <div class="calib-hint" id="calibHint">üëÜ –ü–æ—Å—Ç–∞–≤—å—Ç–µ –≤—Ç–æ—Ä—É—é —Ç–æ—á–∫—É</div>

    <div class="modal" id="calibModal" aria-hidden="true">
        <div class="modal-content">
            <h3>üìè –í–≤–µ–¥–∏—Ç–µ –¥–ª–∏–Ω—É –ª–∏–Ω–∏–∏</h3>
            <input type="number" id="calibLength" value="100" min="1" inputmode="numeric" placeholder="–î–ª–∏–Ω–∞ –≤ –º–º" />
            <div class="modal-btns">
                <button class="btn" id="calibCancel">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" id="calibOk">‚úì OK</button>
            </div>
        </div>
    </div>

    <div class="modal" id="projectNameModal" aria-hidden="true">
        <div class="modal-content">
            <h3>üìÅ –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞</h3>
            <input type="text" id="projectNameInput" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ñ–ö –°–æ–ª–Ω–µ—á–Ω—ã–π" />
            <div class="modal-btns">
                <button class="btn" id="projectNameCancel">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" id="projectNameOk">‚úì –°–æ–∑–¥–∞—Ç—å</button>
            </div>
        </div>
    </div>

    <div class="modal" id="deleteModal" aria-hidden="true">
        <div class="modal-content">
            <h3 id="deleteModalTitle">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç?</h3>
            <p class="modal-text" id="deleteModalText">–í—Å–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –±–µ–∑–≤–æ–∑–≤—Ä–∞—Ç–Ω–æ.</p>
            <div class="modal-btns">
                <button class="btn" id="deleteCancel">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-danger" id="deleteOk">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <div class="selection-panel" id="selectionPanel">
        <div class="selection-header">
            <span class="selection-title">–§—Ä–∞–≥–º–µ–Ω—Ç</span>
            <button class="selection-close" id="selectionClose">‚úï</button>
        </div>
        <div class="selection-preview">
            <img id="selectionImg" />
        </div>
        <div class="selection-actions">
            <button class="btn btn-primary" id="saveSelectPdfBtn">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
                    stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7 10 12 15 17 10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
                <span>PDF</span>
            </button>
            <button class="btn btn-extract" id="printTiledBtn" title="–ü–µ—á–∞—Ç—å –º–æ–∑–∞–∏–∫–æ–π (A4)">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
                    stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="3" y1="9" x2="21" y2="9"></line>
                    <line x1="3" y1="15" x2="21" y2="15"></line>
                    <line x1="9" y1="3" x2="9" y2="21"></line>
                    <line x1="15" y1="3" x2="15" y2="21"></line>
                </svg>
                <span>–ü–µ—á–∞—Ç—å</span>
            </button>

        </div>
    </div>

    <!-- –¢–ò–†–ê–ñ–ò–†–û–í–ê–ù–ò–ï / –ü–ï–ß–ê–¢–¨ –ú–û–ó–ê–ò–ö–û–ô -->
    <div id="printTiledModal" class="modal" style="display: none;">
        <div class="modal-backdrop" onclick="closeModal($('printTiledModal'))"></div>
        <div class="modal-content print-tiled-content">
            <div class="modal-header">
                <h2 class="modal-title">–ü–µ—á–∞—Ç—å —Å–µ—Ç–∫–æ–π</h2>
                <button class="btn-close" onclick="closeModal($('printTiledModal'))">&times;</button>
            </div>

            <div class="print-tiled-body">
                <div class="print-tiled-preview-container">
                    <div id="tiledPreviewWrapper" class="tiled-preview-wrapper">
                        <canvas id="tiledPreviewCanvas"></canvas>
                        <div id="tiledGridOverlay" class="tiled-grid-overlay"></div>
                    </div>
                </div>

                <div class="print-tiled-controls">
                    <div class="control-group">
                        <label>–¶–µ–ª–µ–≤–æ–π —Ñ–æ—Ä–º–∞—Ç:</label>
                        <div class="format-chips">
                            <button class="chip active" data-format="A4">A4</button>
                            <button class="chip" data-format="A3">A3</button>
                            <button class="chip" data-format="A2">A2</button>
                            <button class="chip" data-format="A1">A1</button>
                            <button class="chip" data-format="A0">A0</button>
                        </div>
                        <div style="margin-top: 10px; display: flex; gap: 10px;">
                            <button class="btn btn-sm active" id="tiledOrientPortrait">–ü–æ—Ä—Ç—Ä–µ—Ç–Ω–∞—è ‚ñØ</button>
                            <button class="btn btn-sm" id="tiledOrientLandscape">–ê–ª—å–±–æ–º–Ω–∞—è ‚ñ≠</button>
                        </div>
                    </div>

                    <div class="control-group">
                        <label>–ú–∞—Å—à—Ç–∞–± –∏ –ø–æ–≤–æ—Ä–æ—Ç:</label>
                        <div class="modal-btns" style="margin-top: 8px; gap: 8px;">
                            <button class="btn btn-sm" id="tiledRotateBtn" title="–ü–æ–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ 90¬∞">‚Ü© –ü–æ–≤–µ—Ä–Ω—É—Ç—å</button>
                            <button class="btn btn-sm" id="tiledResetBtn" title="–°–±—Ä–æ—Å–∏—Ç—å">‚ü≤ –°–±—Ä–æ—Å</button>
                        </div>
                        <div class="zoom-range-container"
                            style="margin-top: 12px; display: flex; align-items: center; gap: 10px;">
                            <button id="tiledZoomOutBtn" class="btn-icon-tiny" title="–£–º–µ–Ω—å—à–∏—Ç—å">‚àí</button>
                            <input type="range" id="tiledZoomSlider" min="0.1" max="3" step="0.05" value="1"
                                style="flex: 1; accent-color: #7c5cff;">
                            <button id="tiledZoomInBtn" class="btn-icon-tiny" title="–£–≤–µ–ª–∏—á–∏—Ç—å">+</button>
                        </div>
                    </div>

                    <div class="control-group info-stats">
                        <div class="stat">–õ–∏—Å—Ç–æ–≤ A4: <span id="tiledSheetCount">0</span></div>
                        <div class="stat">–†–∞–∑–º–µ—Ä: <span id="tiledFinalSize">?</span></div>
                    </div>

                    <div class="control-group">
                        <label class="checkbox-container">
                            <input type="checkbox" id="tiledHintsToggle" checked>
                            <span class="checkmark"></span>
                            –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫–∏ –∏ –Ω–∞—Ö–ª–µ—Å—Ç (5–º–º)
                        </label>
                    </div>

                    <div class="modal-btns">
                        <button class="btn btn-secondary" id="tiledPrintDirectBtn" title="–°—Ä–∞–∑—É –Ω–∞ –ø–µ—á–∞—Ç—å">üñ®Ô∏è
                            –ü–µ—á–∞—Ç—å</button>
                        <button class="btn" onclick="closeModal($('printTiledModal'))">–û—Ç–º–µ–Ω–∞</button>
                        <button class="btn btn-primary" id="tiledGenerateBtn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <!-- EXTRACT PAGES MODAL -->
    <div class="modal-overlay" id="extractModal" aria-hidden="true" style="display: none;">
        <div class="modal-backdrop" onclick="closeModal($('extractModal'))"></div>
        <div class="modal-container extract-modal-container">
            <div class="modal-header">
                <div>
                    <h2 class="modal-title">–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü</h2>
                    <div class="selected-pages-info" id="extractSelectedInfo">–í—ã–±—Ä–∞–Ω–æ: 0</div>
                </div>
                <div class="extract-size-control">
                    <span class="size-icon small">üîç</span>
                    <input type="range" id="extractSizeSlider" min="80" max="220" value="140" class="size-slider">
                    <span class="size-icon large">üîç</span>
                </div>
            </div>
            <div class="extract-grid-wrapper">
                <div class="extract-grid" id="extractGrid">
                    <!-- Thumbnails will be generated here -->
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="extractCancel">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-secondary" id="extractPrintBtn" disabled>üñ®Ô∏è –ü–µ—á–∞—Ç—å</button>
                <button class="btn btn-primary" id="extractSaveBtn" disabled>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å PDF</button>
            </div>
        </div>
    </div>

    <!-- Preview popup for long-press (OUTSIDE modal for proper z-index) -->
    <div id="extractPreview" class="extract-preview">
        <div class="extract-preview-content">
            <img id="extractPreviewImg" src="" alt="Preview">
            <div class="extract-preview-page" id="extractPreviewPage"></div>
        </div>
    </div>

    <!-- TEXT MODAL -->
    <div id="textModal" class="modal" style="display: none;">
        <div class="modal-backdrop" onclick="closeModal($('textModal'))"></div>
        <div class="modal-content" style="max-width: 380px;">
            <div class="modal-header"
                style="display: flex; justify-content: space-between; align-items: center; padding-bottom: 16px; border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: 20px;">
                <h3 class="modal-title" style="margin: 0; font-size: 18px; color: #fff;">–¢–µ–∫—Å—Ç / –ó–∞–º–µ—Ç–∫–∞</h3>
                <button class="btn-close" onclick="closeModal($('textModal'))"
                    style="background: none; border: none; font-size: 24px; color: rgba(255,255,255,0.5); cursor: pointer; padding: 0; line-height: 1;">&times;</button>
            </div>

            <div style="margin-bottom: 20px;">
                <textarea id="textInputContent" class="text-input-area" rows="3" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç..."
                    style="width: 100%; padding: 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); background: rgba(0,0,0,0.2); color: #fff; font-size: 15px; resize: none; outline: none; font-family: inherit;"
                    onfocus="this.style.borderColor='rgba(124, 92, 255, 0.6)'; this.style.background='rgba(0,0,0,0.3)'"
                    onblur="this.style.borderColor='rgba(255,255,255,0.1)'; this.style.background='rgba(0,0,0,0.2)'"></textarea>
            </div>

            <div style="display: flex; flex-direction: column; gap: 16px; margin-bottom: 24px;">
                <!-- –§–æ–Ω -->
                <div style="display: flex; align-items: center; justify-content: space-between;">
                    <span style="font-size: 14px; font-weight: 500; color: rgba(255,255,255,0.7);">–§–æ–Ω –ø–ª–∞—à–∫–∏</span>
                    <div class="color-opts" id="textBgOpts" style="display: flex; gap: 10px;">
                        <button class="color-btn active" data-color="transparent" title="–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π"
                            style="width: 30px; height: 30px; border-radius: 50%; border: 1px solid rgba(255,255,255,0.2); background: conic-gradient(#555 25%, #333 0 50%, #555 0 75%, #333 0); color: #ccc; display: flex; align-items: center; justify-content: center; font-size: 10px;">‚úï</button>
                        <button class="color-btn" data-color="#ffffff"
                            style="width: 30px; height: 30px; border-radius: 50%; border: 1px solid rgba(255,255,255,0.2); background:#fff;"
                            title="–ë–µ–ª—ã–π"></button>
                        <button class="color-btn" data-color="#fef3c7"
                            style="width: 30px; height: 30px; border-radius: 50%; border: 1px solid rgba(255,255,255,0.2); background:#fef3c7;"
                            title="–ñ–µ–ª—Ç—ã–π"></button>
                        <button class="color-btn" data-color="#000000"
                            style="width: 30px; height: 30px; border-radius: 50%; border: 1px solid rgba(255,255,255,0.4); background:#000;"
                            title="–ß–µ—Ä–Ω—ã–π"></button>
                    </div>
                </div>

                <!-- –¢–µ–∫—Å—Ç -->
                <div style="display: flex; align-items: center; justify-content: space-between;">
                    <span style="font-size: 14px; font-weight: 500; color: rgba(255,255,255,0.7);">–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞</span>
                    <div class="color-opts" id="textColorOpts" style="display: flex; gap: 10px;">
                        <button class="color-btn active" data-color="#000000"
                            style="width: 30px; height: 30px; border-radius: 50%; border: 1px solid rgba(255,255,255,0.4); background:#000;"
                            title="–ß–µ—Ä–Ω—ã–π"></button>
                        <button class="color-btn" data-color="#ef4444"
                            style="width: 30px; height: 30px; border-radius: 50%; border: 1px solid rgba(255,255,255,0.2); background:#ef4444;"
                            title="–ö—Ä–∞—Å–Ω—ã–π"></button>
                        <button class="color-btn" data-color="#3b82f6"
                            style="width: 30px; height: 30px; border-radius: 50%; border: 1px solid rgba(255,255,255,0.2); background:#3b82f6;"
                            title="–°–∏–Ω–∏–π"></button>
                        <button class="color-btn" data-color="#ffffff"
                            style="width: 30px; height: 30px; border-radius: 50%; border: 1px solid rgba(255,255,255,0.2); background:#fff;"
                            title="–ë–µ–ª—ã–π"></button>
                    </div>
                </div>
            </div>

            <div class="modal-btns"
                style="margin-top: 0; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1); justify-content: flex-end;">
                <button class="btn"
                    style="background: transparent; border: 1px solid rgba(255,255,255,0.2); color: rgba(255,255,255,0.8);"
                    onclick="closeModal($('textModal'))">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" id="textPlaceActionBtn">–î–æ–±–∞–≤–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <script src="app.js?v=89"></script>
</body>

</html>
